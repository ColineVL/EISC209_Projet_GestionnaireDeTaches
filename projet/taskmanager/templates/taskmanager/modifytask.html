{% extends "base.html" %}
{% block title %}{{ method }} task{% endblock %}
{% load bootstrap4 %}

{# Barre de navigation #}
{% block nav %}
    <!-- Ce n'est pas la même selon si on édite une tâche ou si on en crée une nouvelle -->
    <ul class="nav">
        <li class="nav-item">
            <a class="nav-link" href={% url "projects" %}>Projets</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'project' projet.id %}">{{ projet }}</a>
        </li>
        {% if method == 'Edit' %}
            <!-- Cas édition de tâche -->
            <li class="nav-item">
                <a class="nav-link" href="{% url 'task' tache.id %}">{{ tache }}</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'edittask' tache.id %}">Edit task</a>
            </li>
        {% else %}
            <!-- Cas création d'une nouvelle tâche -->
            <li class="nav-item">
                <a class="nav-link" href="{% url 'newtask' projet.id %}">New task</a>
            </li>
        {% endif %}
    </ul>
{% endblock %}

{# Contenu de la page #}
{% block content %}
    <!-- Titre de la page -->
    <div class="container" id="titre">
        <h2>{{ projet }}</h2>
        <h4>{{ method }} task</h4>
        <br>
    </div>

    <div class="container" id="form">
        <!-- On n'appelle pas le même form selon si on est en édition ou en création -->
        {% if method == 'Edit' %}
            <!-- Cas édition -->
            <form action="{% url "edittask" tache.id %}" method="post">
        {% else %}
            <!-- Cas création -->
            <form action="{% url "newtask" projet.id %}" method="post">
        {% endif %}
        <!-- Dans les deux cas, affichage du form -->
        {% csrf_token %}

        {# debut test #}
        {% bootstrap_field form.name layout='horizontal' %}
        {% bootstrap_field form.description layout='horizontal' %}

        <div class="form-group row"><label class="col-md-3 col-form-label" for="id_assignee">Assignee</label>
            <div class="col-md-9">
                <select name="assignee" class="form-control" title="" required id="id_assignee">
                    <option value="">---------</option>
                    {% for mem in list_members %}
                        {% if task.assignee == mem.id %}
                            <option value={{ mem.id }} selected>{{ mem }}</option>
                        {% else %}
                            <option value={{ mem.id }}>{{ mem }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>

        {# Essai calendrier #}
        <div class="form-group row">
            <label class="col-md-3 col-form-label" for="id_start_date">Start date</label>
            <div class="col-md-9">
                <div class="input-group date" id="id_start_date" data-target-input="nearest">
                    <input type="text" name="start_date" class="form-control datetimepicker-input"
                           placeholder="Start date" title="" required id="id_start_date">
                    <div class="input-group-append" data-target="#id_start_date" data-toggle="datetimepicker">
                        <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(function () {
                $("#id_start_date").datetimepicker({
                    {#format: 'L',#}
                    format: 'DD/MM/YYYY',
                });
            });
        </script>
        {# Fin de l'essai #}

        {#        {% bootstrap_field form.start_date layout='horizontal' %}#}
        {% bootstrap_field form.due_date layout='horizontal' %}
        {% bootstrap_field form.priority layout='horizontal' %}
        {% bootstrap_field form.status layout='horizontal' %}
        {# fin test #}
        {% buttons %}
            <button type="submit" class="btn btn-primary">Save</button>
        {% endbuttons %}
        </form>
    </div>

{% endblock %}