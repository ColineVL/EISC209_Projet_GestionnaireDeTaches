{% extends "base.html" %}
{% block title %}Project{% endblock %}
{% load bootstrap4 %}
{% load static %}


{# Haut de page #}
{% block head %}
    <!-- Titre de la page et boutons -->
    <div class="container" id="titre">
        <div class="row">
            <h1 class="col-sm-7">
                {# Nom du projet #}
                {{ project_to_display }}
            </h1>
            {# Bouton pour ajouter une tâche #}
            {# TODO c'est quoi ce m-3 ? #}
            {# TODO en mode tablette, les boutons ne s'affichent pas bien (l'un va à la ligne)#}
            <button class="col-sm-2 btn btn-primary m-3"
                    onclick="window.location.href='{% url "newtask" id_project %}'">
                <i class="fa fa-plus-circle fa-lg" title="New task" aria-hidden="true"></i>
                Nouvelle tâche
            </button>

            {# Bouton pour modifier le projet #}
            <button class="col-sm-2 btn btn-primary m-3"
                    onclick="window.location.href='{% url "editproject" id_project %}'">
                <i class="fa fa-pencil-square-o fa-lg" title="Edit project" aria-hidden="true"></i>
                Modifier le projet
            </button>

            {# Bouton pour le filtrage #}
            <button data-toggle="collapse" data-target="#filter" class="col-sm-1.5 btn btn-primary m-3">
                <i class="fa fa-filter fa-lg" title="Filtre" aria-hidden="true"></i>
                Filtrage
            </button>

            {# Bouton pour le triage #}
            <button data-toggle="collapse" data-target="#ordering" class="col-sm-1 btn btn-primary m-3">
                <i class="fa fa-sort fa-lg" title="Ordering" aria-hidden="true"></i>
                Triage
            </button>

            {# container pour le formulaire du filtrage #}
            <div id="filter" class="collapse">
                <form method="GET">
                    {{ filter.form }}
                    <button type="submit" class="btn btn-primary">Chercer</button>
                </form>
            </div>

            {# container pour le formulaire du triage #}
            <div id="ordering" class="collapse">
                <form method="GET">
                    {{ ordering.form }}
                    <button type="submit" class="btn btn-primary">Trier</button>
                </form>
            </div>

        </div>
    </div>
{% endblock %}

{# Contenu de la page #}
{% block content %}
    <!-- Liste des tâches -->
    <div class="container" id="listeTaches">

        {% if list_tasks %}
            <!-- Cas où la liste des tâches n'est pas vide -->
            <table class="table table-hover table-responsive-sm">
                <!-- En-tête de la table -->
                <thead class="thead-light">
                <tr>
                    <th>Tâche</th>
                    <th>Assignée à</th>
                    <th>Date de début</th>
                    <th>Date de fin</th>
                    <th>Priorité</th>
                    <th>Taux d'avancement</th>
                    <th></th>
                </tr>
                </thead>
                <!-- Corps de la table, boucle sur les tâches -->
                <tbody>
                {% for task in filter.qs %}
                    {# Cet if permet de mettre en avant les tâches de l'utilisateur connecté #}
                    {% if task.assignee == request.user %}
                        <tr class="table-primary">
                            {% else %}
                        <tr>
                    {% endif %}
                <td><a href="{% url 'task' task.id %}">{{ task|truncatechars:100 }}</a></td>
                <td class="text-center"><span class="badge badge-primary">{{ task.assignee }}</span></td>
                <td><i>{{ task.start_date|date:"SHORT_DATE_FORMAT" }}</i></td>
                <td><i>{{ task.due_date|date:"SHORT_DATE_FORMAT" }}</i></td>
                <td class="text-center">{{ task.priority }} / 10</td>
                <td class="text-center">{{ task.progress }} %</td>
                <td>
                    <a href="{% url 'edittask' task.id %}">
                        <p><i class="fa fa-pencil-square-o fa-2x" title="Modify task"
                              aria-hidden="true"></i></p>
                    </a>
                </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>

        {% else %}
            <!-- Cas où le projet n'a aucune tâche associée -->
            <p>Aucune tâche !</p>
        {% endif %}

    </div>

    <!-- Affichage d'un diagramme de Gantt -->
    <div class="container" id="gantt">
        {# On fait passer les variables utiles au javascript#}
        {{ project_to_display.name | json_script:"name_project" }}
        {{ list_dicts | json_script:"list_dicts" }}
        {# On appelle le script #}
        <script type="text/javascript" src="{% static 'js/basicGanttChart.js' %}"></script>
    </div>

{% endblock %}
